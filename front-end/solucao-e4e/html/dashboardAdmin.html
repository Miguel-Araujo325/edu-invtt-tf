<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin</title>

    <link rel="stylesheet" href="../css/dashboardAdmin.css">
    <link rel="stylesheet" href="../css/dashboardProfessor.css">
    <link rel="stylesheet" href="../css/menu.css">

    <script defer src="../js/script.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <link rel="icon" type="image/png" href="../imgs/english4ever.png">

    <!-- CSS do Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <!-- JS do Flatpickr -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>

    <!-- Plugin para Seleção de Mês -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/index.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/monthSelect/style.css">

</head>
<style>
    .flatpickr-weekdays {
        display: none !important;
    }
</style>

<body>
    <nav class="sidebar" id="sidebar">
        <div class="hamburger">
            <a class="main-nav-toggle" href="#main-nav" id="toggle-btn"><i>Menu</i></a>
        </div>
        <ul class="nav flex-column">
            <li class="nav-item">
                <a id="dashboard_href" href="#" class="nav-link">
                    <img src="../imgs/botao-home.png" alt=""> <span class="ms-2">Início</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#agendaDropdown"
                    aria-expanded="false">
                    <img src="../imgs/calendar-days.png" alt=""> <span class="ms-2">Agenda</span>
                </a>
                <div class="collapse" id="agendaDropdown">
                    <ul class="nav flex-column dropdown-container">
                        <li><a href="calendarioAluno.html" id="agenda_novo_agendamento_navbar" class="nav-link">Novo
                                Agendamento</a></li>
                        <li><a href="agendamentos.html?tipo=futuro" id="agenda_meus_agendamentos_navbar"
                                class="nav-link">Meus Agendamentos</a></li>
                        <li><a href="agendamentos.html?tipo=passado" id="agenda_historico_navbar"
                                class="nav-link">Histórico</a></li>
                    </ul>
                </div>
            </li>
            <li class="nav-item" id="alunos_navbar">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse" data-bs-target="#alunosDropdown"
                    aria-expanded="false">
                    <img src="../imgs/students.png" alt=""> <span class="ms-2">Alunos</span>
                </a>
                <div class="collapse" id="alunosDropdown">
                    <ul class="nav flex-column dropdown-container">
                        <li><a href="visualizar.html?tipo=aluno" class="nav-link">Visualizar</a></li>
                        <li><a href="cadastrar.html?tipo=aluno" class="nav-link">Cadastrar</a></li>
                    </ul>
                </div>
            </li>
            <li class="nav-item" id="professores_navbar">
                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="collapse"
                    data-bs-target="#professoresDropdown" aria-expanded="false">
                    <img src="../imgs/professor.png" alt=""> <span class="ms-2">Professores</span>
                </a>
                <div class="collapse" id="professoresDropdown">
                    <ul class="nav flex-column dropdown-container">
                        <li><a href="visualizar.html?tipo=professor" class="nav-link">Visualizar</a></li>
                        <li><a href="cadastrar.html?tipo=professor" id="cadastro_professor"
                                class="nav-link">Cadastrar</a></li>
                    </ul>
                </div>
            </li>
            <li class="nav-item">
                <a href="perfil.html" id="perfil_navbar" class="nav-link">
                    <img src="../imgs/perfil.png" alt=""> <span class="ms-2">Perfil</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="http://20.161.82.110/" target="_blank" class="nav-link">
                    <img src="../imgs/moodle.png" alt=""> <span class="ms-2">Moodle</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="login2.html" class="nav-link">
                    <img src="../imgs/sair.png" alt=""> <span class="ms-2" style="color: white;">Sair</span>
                </a>
            </li>
        </ul>
    </nav>

    <div class="conteudo">
        <div class="spaces-professor">
            <br>
            <div class="title-agendamento">
                <div class="spaces-professor">
                    <h2 class="title-title">Visão Global de Performance de Professores</h2>
                </div>
            </div>
            <div class="select-professor" id="div-professor-select" style="display: none;">
                <p>Selecione um professor para visualizar os dados:</p>
                <select name="professores" id="professores"> a
                    <option value="">Selecione um professor</option>
                </select>
            </div>
            <div class="space-professor">
                <div class="buttons-professor">
                    <h2 id="nome_titulo">Joseph Smith</h2>
                </div>
                <br>
                <div class="title-agendamento">
                    <p>Próximos Agendamentos</p>
                </div>
            </div>
            <div class="agendamentos" id="agendamentos-futuros">
                <div class="box">
                    <div class="data">
                        <h2 class="dia_proxima_data">28</h2>
                        <p class="mes_proxima_data">Setembro</p>
                    </div>
                    <div class="content">
                        <p class="dia_semana_proxima_data">Quinta-Feira</p>
                        <p class="horario_proxima_data">08:00 PM</p>
                        <p class="nome_aluno_proxima_data">Lucas Silva</p>
                    </div>
                </div>
                <div class="box">
                    <div class="data">
                        <h2>29</h2>
                        <p>Outubro</p>
                    </div>
                    <div class="content">
                        <p>Sexta-Feira</p>
                        <p>08:00 PM</p>
                        <p>Lucas Silva</p>
                    </div>
                </div>
                <div class="box">
                    <div class="data">
                        <h2>30</h2>
                        <p>Novembro</p>
                    </div>
                    <div class="content">
                        <p>Sábado</p>
                        <p>08:00 PM</p>
                        <p>Lucas Silva</p>
                    </div>
                </div>
            </div>
            <br><br>
        </div>
        <hr class="line">
        <br>
        <div class="space-professor">
            <div class="title-agendamento">
                <p>KPI's - Aulas do mês</p>
            </div>
        </div>
        <div class="kpis" style="position: relative; bottom: 5vh;">
            <div class="box-kpis-admin">
                <div class="line-box">
                </div>
                <div class="content-kpis">
                    <p>Total de aulas</p>
                    <h2 id="agendamentos-total"></h2>
                </div>
            </div>
            <div class="box-kpis-admin">
                <div class="line-box">
                </div>
                <div class="content-kpis">
                    <p>Aulas confirmadas</p>
                    <h2 id="agendamentos-confirmado"></h2>
                </div>
            </div>
            <div class="box-kpis-admin">
                <div class="line-box">
                </div>
                <div class="content-kpis">
                    <p>Aulas concluídas</p>
                    <h2 id="agendamentos-concluido"></h2>
                </div>
            </div>
            <div class="box-kpis-admin">
                <div class="line-box">
                </div>
                <div class="content-kpis">
                    <p>
                        Aulas canceladas
                        <span class="info-icon" title="Número total de aulas canceladas e transferidas.">i</span>
                    </p>
                    <h2 id="agendamentos-cancelado"></h2>
                </div>
            </div>
        </div>
        <br>
        <hr class="line">
        <br><br>
        <h2 class="title-title">Cumprimento professor</h2>
        <span id="title-chart-admin">Aulas Concluídas vs. Meta Mensal</span>
        <br><br>
        <div class="filtro-graph">
            <label for="mes-ano-input" class="form-filtro-graph">Selecione o período:</label>
            <input class="form-select-graph" type="text" id="mes-ano-input" />
            <!-- <div class="button-container" style="gap: 2vw;">
                <button type="button" class="custom-button">
                    <i class="fas fa-download" style="margin-right: 5px;"></i> Exportar Dados
                </button>
            </div> -->
        </div>
        <div class="kpis" id="kpis">
            <div class="box-chart-admin">
                <canvas id="myChartMeta"></canvas>
            </div>
            <div class="kpis-metas" id="top3-meses">
                <div class="box-kpis-metas">
                    <div class="line-box-metas">
                    </div>
                    <div class="content-kpis" id="alunos-novos">
                        <p>Meta de aulas</p>
                        <h2 id="agendamento-meta">30</h2>
                    </div>
                </div>
                <div class="box-kpis-metas">
                    <div class="line-box-metas">
                    </div>
                    <div class="content-kpis" id="cancelamento">
                        <p id="p-progresso">Progresso atual</p>
                        <h2 id="agendamento-meta-percentual">30%</h2>
                    </div>
                </div>
            </div>
        </div>
        <br><br>
        <hr class="line">
        <br><br>
        <h2 class="title-title">Taxa de Cancelamento</h2>
        <div class="filtro-graph">
            <label class="form-filtro-graph" for="ano-input">Selecione o Ano:</label>
            <input class="form-select-graph" type="text" id="ano-input" placeholder="Selecione o Ano" />
        </div>
        <br><br>
        <div class="box-chart2">
            <canvas id="chartCancelamento"></canvas>
        </div>
    </div>
</body>

</html>

<script>
    window.onload = () => {
        const script = document.createElement("script");
        if (typeof ambiente !== "undefined" && ambiente === "desenvolvimento") {
            script.src = "../js/mock/dashAdmin.js";
        } else if (typeof ambiente !== "undefined" && ambiente === "apresentacao") {
            script.src = "../js/dashboard/dashAdmin.js";
        }
        script.defer = true;
        document.head.appendChild(script);
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Flatpickr para #mes-ano-input
        const flatpickrInput = document.querySelector("#mes-ano-input");
        if (flatpickrInput) {
            flatpickr("#mes-ano-input", {
                locale: "pt",
                dateFormat: "F Y",
                defaultDate: new Date(),
                maxDate: new Date(),
                plugins: [
                    new monthSelectPlugin({
                        shorthand: false,
                        dateFormat: "F Y",
                        altFormat: "F Y"
                    })
                ],
                onChange: function (selectedDates, dateStr) {
                    const selectedDate = selectedDates[0]; // Data selecionada
                    const currentDate = new Date(); // Data atual

                    // Obtém os elementos
                    const progressoLabel = document.querySelector("#p-progresso");

                    if (selectedDate && progressoLabel) {
                        // Compara o mês e o ano selecionados com o mês e o ano atuais
                        if (
                            selectedDate.getMonth() === currentDate.getMonth() &&
                            selectedDate.getFullYear() === currentDate.getFullYear()
                        ) {
                            progressoLabel.textContent = "Progresso atual";
                        } else {
                            progressoLabel.textContent = "Porcentagem alcançada";
                        }
                    }

                    plotarGraficoCumprimento(sessionStorage.getItem("id"));
                    plotarKpiCumprimento(sessionStorage.getItem("id"));
                }
            });
        } else {
            console.error("Elemento #mes-ano-input não encontrado na página.");
        }

        // Flatpickr para #ano-input
        const flatpickrInputAno = document.querySelector("#ano-input");
        if (flatpickrInputAno) {
            const flatpickrInstance = flatpickr("#ano-input", {
                locale: "pt",
                dateFormat: "Y",
                defaultDate: new Date(),
                maxDate: new Date(),
                onReady: function (selectedDates, dateStr, instance) {
                    const daysContainer = instance.calendarContainer.querySelector(".flatpickr-days");
                    const monthDropdown = instance.calendarContainer.querySelector(".flatpickr-monthDropdown-months");

                    if (daysContainer) daysContainer.style.display = "none";
                    if (monthDropdown) monthDropdown.style.display = "none";

                    const prevButton = instance.calendarContainer.querySelector(".flatpickr-prev-month");
                    const nextButton = instance.calendarContainer.querySelector(".flatpickr-next-month");
                    if (prevButton && nextButton) {
                        prevButton.addEventListener("click", () => {
                            instance.changeYear(instance.currentYear - 1);
                            updateInputValueAndPlot(instance);
                        });
                        nextButton.addEventListener("click", () => {
                            instance.changeYear(instance.currentYear + 1);
                            updateInputValueAndPlot(instance);
                        });
                    }
                },
                onOpen: function (selectedDates, dateStr, instance) {
                    instance.changeYear(new Date().getFullYear());
                },
                onChange: function (selectedDates, dateStr, instance) {
                    flatpickrInputAno.value = dateStr;

                    plotarGraficoTaxaCancelamento(sessionStorage.getItem("id"));
                }
            });

            function updateInputValueAndPlot(instance) {
                const year = instance.currentYear.toString();
                flatpickrInputAno.value = year;
                plotarGraficoTaxaCancelamento(sessionStorage.getItem("id"));
            }

            const initialYear = new Date().getFullYear().toString();
            flatpickrInputAno.value = initialYear;
        } else {
            console.error("Elemento #ano-input não encontrado na página.");
        }

        if (typeof ambiente !== "undefined") {
            console.log(`VOCÊ ESTÁ EM ${ambiente.toUpperCase()}`);
        } else {
            console.log("Ambiente não definido.");
        }
    });

</script>